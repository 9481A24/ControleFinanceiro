<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Organização Financeira</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background: #f5f5f5;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .linha {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .linha img {
      width: 50px;
    }
    .valor {
      width: 100px;
      font-size: 14px;
      padding: 5px 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
    }
    .nome-pequeno {
      font-size: 12px;
      min-width: 100px;
      color: #555;
    }
    .input-nome {
      width: 130px;
      font-size: 14px;
      padding: 5px 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      margin-top: 20px;
      padding: 10px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      width: 200px;
      align-self: start;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="linha">
    <img src="https://raw.githubusercontent.com/9481A24/ControleFinanceiro/main/download.png" alt="">
    <input class="valor" type="text" id="faturamento" placeholder="R$ 0,00" readonly>
    <div class="nome-pequeno">Faturamento</div>
  </div>

  <div class="linha">
    <img src="https://raw.githubusercontent.com/9481A24/ControleFinanceiro/main/download.png" alt="">
    <input class="valor" type="text" id="imposto" placeholder="R$ 0,00" readonly>
    <div class="nome-pequeno">Imposto</div>
  </div>

  <div class="linha">
    <img src="https://raw.githubusercontent.com/9481A24/ControleFinanceiro/main/download.png" alt="">
    <input class="valor" type="text" id="valorFuncionario" placeholder="R$ 0,00" readonly>
    <input class="input-nome" type="text" placeholder="Nome funcionário">
    <div class="nome-pequeno">Funcionário (30%)</div>
  </div>

  <div class="linha">
    <img src="https://raw.githubusercontent.com/9481A24/ControleFinanceiro/main/download.png" alt="">
    <input class="valor" type="text" id="valorDono" placeholder="R$ 0,00" readonly>
    <div class="nome-pequeno">Prolabore (Dono - 30%)</div>
  </div>

  <div class="linha">
    <img src="https://raw.githubusercontent.com/9481A24/ControleFinanceiro/main/download.png" alt="">
    <input class="valor" type="text" id="valorInvestimento" placeholder="R$ 0,00" readonly>
    <div class="nome-pequeno">Investimento (30%)</div>
  </div>

  <button onclick="zerarCampos()">Zerar Imposto, Funcionário e Prolabore</button>
</div>

<!-- Firebase e JS -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBqYQKqnPKSm0GyziIsGNmyamEevpki0YE",
    authDomain: "controlefinanceiro-23fce.firebaseapp.com",
    projectId: "controlefinanceiro-23fce",
    storageBucket: "controlefinanceiro-23fce.appspot.com",
    messagingSenderId: "967993151955",
    appId: "1:967993151955:web:ac2711081550ee34519f26"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function formatarValor(valor) {
    return `R$ ${valor.toFixed(2).replace('.', ',')}`;
  }

  // --- Função para ler investimento acumulado do Firestore ---
  async function lerInvestimentoAcumulado() {
    const docRef = doc(db, "config", "investimentoAcumulado");
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      return docSnap.data().valor || 0;
    } else {
      // Se não existir, inicializa com zero
      await setDoc(docRef, { valor: 0 });
      return 0;
    }
  }

  // --- Função para salvar investimento acumulado no Firestore ---
  async function salvarInvestimentoAcumulado(valor) {
    const docRef = doc(db, "config", "investimentoAcumulado");
    await setDoc(docRef, { valor: valor });
  }

  async function calcularTotais() {
    const entradasRef = collection(db, "entradas_completas");
    const snapshot = await getDocs(entradasRef);

    let totalFaturamento = 0;
    let totalImposto = 0;

    snapshot.forEach(doc => {
      const data = doc.data();
      totalFaturamento += data.entradaValor || 0;
      totalImposto += data.imposto || 0;
    });

    const restante = totalFaturamento - totalImposto;
    const porcentagem = restante / 100 * 30;

    // Preencher campos
    document.getElementById('faturamento').value = formatarValor(totalFaturamento);
    document.getElementById('imposto').value = formatarValor(totalImposto);
    document.getElementById('valorFuncionario').value = formatarValor(porcentagem);
    document.getElementById('valorDono').value = formatarValor(porcentagem);

    // Ler investimento acumulado do Firestore
    let investimentoAtual = await lerInvestimentoAcumulado();

    investimentoAtual += porcentagem;

    document.getElementById('valorInvestimento').value = formatarValor(investimentoAtual);

    // Salvar investimento atualizado no Firestore
    await salvarInvestimentoAcumulado(investimentoAtual);
  }

  function zerarCampos() {
    document.getElementById('imposto').value = 'R$ 0,00';
    document.getElementById('valorFuncionario').value = 'R$ 0,00';
    document.getElementById('valorDono').value = 'R$ 0,00';
    // investimento NÃO é zerado
  }

  calcularTotais();
</script>

</body>
</html>
